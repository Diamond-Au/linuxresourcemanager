<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SOURCEINFO</title>
    <link rel="stylesheet" href="./index.css" />
    <script src="./echarts.js"></script>
  </head>
  <body>
    <div class="container">
      <!-- the display of cpu -->
      <div class="cpu-wrapper"></div>

      <!-- the display of memory -->
      <div class="memory-wrapper">
        <div class="memory-info">
          <h1>memory info</h1>
          <div id="memory" style="width: 300px; height: 300px"></div>
          <div class="memory-detail" id="memory-detail"></div>
        </div>
        <div class="swap-info">
          <h1>swap info</h1>
          <div id="swap" style="width: 300px; height: 300px"></div>
          <div class="swap-detail" id="swap-detail"></div>
        </div>
      </div>

      <!-- the display of net -->
      <div class="net-wrapper"></div>
    </div>
  </body>
  <script>
    const {
      getComputerNetInfo,
      getComputerSwapInfo,
      getComputerMemotyInfo,
      kbToGB,
    } = require("../../utils/index.js");
    const { Emitter } = require("../../utils/events.js");
    const { getSwapOpstion } = require("../../config/config.js");
    var resSpeed = document.getElementById("res-speed");
    var resSum = document.getElementById("res-sum");
    var sendSpeed = document.getElementById("send-speed");
    var sendSum = document.getElementById("send-sum");
    var swapDetail = document.getElementById("swap-detail");
    var memoryDetail = document.getElementById("memory-detail");
    function getNetSpeed(time) {
      let {
        resiveBytes,
        resivePacks,
        sendBytes,
        sendPacks,
      } = getComputerNetInfo();

      setInterval(() => {
        let res = getComputerNetInfo();

        Emitter.emit("10s", {
          resSpeed: parseInt((res.resiveBytes - resiveBytes) / time),
          resivePacks: res.resivePacks,
          sendSpeed: parseInt((res.sendBytes - sendBytes) / time),
          sendPacks: res.sendPacks,
        });
        resiveBytes = res.resiveBytes;
        resivePaacks = res.resivePaacks;
        sendBytes = res.sendBytes;
        sendPacks = res.sendPacks;
      }, time * 1000);
    }
    window.onload = function () {
      // var netmyChart = echarts.init(document.getElementById("net"));
      var swapMyChart = echarts.init(document.getElementById("swap"));
      var memoryMyChart = echarts.init(document.getElementById("memory"));
      var swapInfo = getComputerSwapInfo();
      var memoryInfo = getComputerMemotyInfo();
      console.log(memoryInfo);
      let used = parseInt(swapInfo.used);
      let all = parseInt(swapInfo.size);
      let left = all - used;
      let swapOption = getSwapOpstion({ used, left });
      let rate = ((used / all) * 100).toFixed(1) + "%";
      console.log(rate);
      let swapTemplate = `
        <span>${(used / 1024).toFixed(2)}MiB (${rate})</span>
        <span>共${kbToGB(all, 2)}GiB</span>
      `;
      swapDetail.innerHTML = swapTemplate;

      all = parseInt(memoryInfo[0]["MemTotal"]);
      left = parseInt(memoryInfo[0]["MemAvailable"]);
      used = all - left;
      let memoryOption = getSwapOpstion({ used, left });
      rate = ((used / all) * 100).toFixed(1) + "%";
      let Cached = memoryInfo[0]["Cached"];
      console.log(Cached);
      let memoryTemplate = `
        <span>${kbToGB(used, 2)}GiB(${rate}) 共${kbToGB(all, 1)}GiB</span></br>
        <span>cache: ${kbToGB(parseInt(Cached), 1)}GiB</span>
      `;
      memoryDetail.innerHTML = memoryTemplate;
      swapMyChart.setOption(swapOption);
      memoryMyChart.setOption(memoryOption);
      console.log(used / all);
    };
  </script>
</html>
